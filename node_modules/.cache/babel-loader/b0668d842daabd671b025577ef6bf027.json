{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport authService from \"./auth.service\";\nimport localStorageService from \"./localStorage.service\";\nimport logger from \"./log.service\";\nconst http = axios.create({\n  baseURL: configFile.apiEndpoint\n});\nhttp.interceptors.request.use(async function (config) {\n  const expiresDate = localStorageService.getTokenExpiresDate();\n  const refreshToken = localStorageService.getRefreshToken();\n  const isExpired = refreshToken && expiresDate < Date.now();\n  if (configFile.isFireBase) {\n    const containSlash = /\\/$/gi.test(config.url);\n    config.url = (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        refreshToken: data.refresh_token,\n        idToken: data.id_token,\n        expiresIn: data.expires_in,\n        localId: data.user_id\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  } else {\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens(data);\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.headers = {\n        ...config.headers,\n        Authorization: `Bearer ${accessToken}`\n      };\n    }\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\nfunction transformData(data) {\n  var _Object$keys;\n  return data && !data._id ? (_Object$keys = Object.keys(data)) === null || _Object$keys === void 0 ? void 0 : _Object$keys.map(key => ({\n    ...data[key]\n  })) : data;\n}\nhttp.interceptors.response.use(res => {\n  if (configFile.isFireBase) {\n    res.data = {\n      content: transformData(res.data)\n    };\n  }\n  res.data = {\n    content: res.data\n  };\n  return res;\n}, function (error) {\n  const expectedErrors = error.response && error.response.status >= 400 && error.response.status < 500;\n  if (!expectedErrors) {\n    logger.log(error);\n    toast.error(\"Something was wrong. Try it later\");\n  }\n  return Promise.reject(error);\n});\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;","map":{"version":3,"names":["axios","toast","configFile","authService","localStorageService","logger","http","create","baseURL","apiEndpoint","interceptors","request","use","config","expiresDate","getTokenExpiresDate","refreshToken","getRefreshToken","isExpired","Date","now","isFireBase","containSlash","test","url","slice","data","refresh","setTokens","refresh_token","idToken","id_token","expiresIn","expires_in","localId","user_id","accessToken","getAccessToken","params","auth","headers","Authorization","error","Promise","reject","transformData","_Object$keys","_id","Object","keys","map","key","response","res","content","expectedErrors","status","log","httpService","get","post","put","delete","patch"],"sources":["/Users/natellaverde/Проекты/MC_Portfolio/src/app/services/http.service.js"],"sourcesContent":["import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport authService from \"./auth.service\";\nimport localStorageService from \"./localStorage.service\";\nimport logger from \"./log.service\";\n\nconst http = axios.create({\n  baseURL: configFile.apiEndpoint\n});\n\nhttp.interceptors.request.use(\n  async function (config) {\n    const expiresDate = localStorageService.getTokenExpiresDate();\n    const refreshToken = localStorageService.getRefreshToken();\n    const isExpired = refreshToken && expiresDate < Date.now();\n\n    if (configFile.isFireBase) {\n      const containSlash = /\\/$/gi.test(config.url);\n      config.url =\n        (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n      if (isExpired) {\n        const data = await authService.refresh();\n\n        localStorageService.setTokens({\n          refreshToken: data.refresh_token,\n          idToken: data.id_token,\n          expiresIn: data.expires_in,\n          localId: data.user_id\n        });\n      }\n      const accessToken = localStorageService.getAccessToken();\n      if (accessToken) {\n        config.params = { ...config.params, auth: accessToken };\n      }\n    } else {\n      if (isExpired) {\n        const data = await authService.refresh();\n        localStorageService.setTokens(data);\n      }\n      const accessToken = localStorageService.getAccessToken();\n      if (accessToken) {\n        config.headers = {\n          ...config.headers,\n          Authorization: `Bearer ${accessToken}`\n        };\n      }\n    }\n    return config;\n  },\n  function (error) {\n    return Promise.reject(error);\n  }\n);\n\nfunction transformData(data) {\n  return data && !data._id\n    ? Object.keys(data)?.map((key) => ({\n      ...data[key]\n    }))\n    : data;\n}\n\nhttp.interceptors.response.use(\n  (res) => {\n    if (configFile.isFireBase) {\n      res.data = { content: transformData(res.data) };\n    }\n    res.data = { content: res.data };\n    return res;\n  },\n  function (error) {\n    const expectedErrors =\n      error.response &&\n      error.response.status >= 400 &&\n      error.response.status < 500;\n\n    if (!expectedErrors) {\n        logger.log(error);\n        toast.error(\"Something was wrong. Try it later\");\n    }\n    return Promise.reject(error);\n  }\n);\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}